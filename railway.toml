[build]
commands = [
  # Create required Laravel directories FIRST
  "mkdir -p storage/framework/{cache,data,sessions,testing,views}",
  "mkdir -p bootstrap/cache",
  "chmod -R 775 storage bootstrap/cache",

  # Install PHP dependencies
  "composer install --optimize-autoloader --no-dev",

  # Install Node dependencies and build frontend
  "npm install",
  "npm run build",

  # Cache Laravel configs, routes, views
  "php artisan config:cache",
  "php artisan route:cache",
  "php artisan view:cache",

  # Ensure storage symlink exists
  "php artisan storage:link",
]

[deploy]
startCommand = "./start.sh"
